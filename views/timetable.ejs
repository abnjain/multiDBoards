<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Time Table</title>
    <link rel="stylesheet" href="/styles/styles.css">
</head>
<body>

    <div class="container">
        <h1>Class Time Table</h1>
        <a href="/" class="btn">Back to Dashboard</a>

        <table border="1">
            <thead>
                <tr>
                    <th>Period</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                    <th>Saturday</th>
                </tr>
            </thead>
            <tbody>
                <% timetable.forEach((row, rowIndex) => { %>
                    <tr>
                        <td>Period <%= rowIndex + 1 %></td>
                        <% row.forEach((cell, colIndex) => { %>
                            <td contenteditable="true" 
                                oninput=`updateCell(<%= rowIndex %>, <%= colIndex %>, this)`>
                                <%= cell %>
                            </td>
                        <% }) %>
                    </tr>
                <% }) %>
            </tbody>
        </table>
        <button onclick="saveTimetable()">Update Timetable</button>
        <button onclick="saveTimetable()">Save Timetable</button>
    </div>

    <script>
        // Function to update individual cell
        function updateCell(row, col, element) {
    const value = element.innerText.trim();

    fetch("/update-timetable", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ row, col, value })
    })
    .then(response => response.json())
    .then(data => {
        console.log("Updated Successfully:", data);
    })
    .catch(error => console.error("Error updating timetable:", error));
}


        // Function to save entire timetable
        function saveTimetable() {
    const table = document.querySelector("table");
    const timetable = [];

    table.querySelectorAll("tbody tr").forEach((row, rowIndex) => {
        const rowData = [];
        row.querySelectorAll("td").forEach((cell, colIndex) => {
            if (colIndex > 0) { // Skip the first column (Period)
                rowData.push(cell.innerText.trim());
            }
        });
        timetable.push(rowData);
    });

    fetch("/save-timetable", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ timetable })
    })
    .then(response => response.json())
    .then(data => {
        console.log("Timetable saved successfully:", data);
        alert("Timetable saved!");
    })
    .catch(error => console.error("Error saving timetable:", error));
}

    </script>

</body>
</html>
